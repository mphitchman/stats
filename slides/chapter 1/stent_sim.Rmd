---
title: "Simulation for Stent Data"
author: "Hitchman"
date: "8/30/2021"
output:
  beamer_presentation:
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Case Study: Using stents to prevent strokes

Stents are devices put inside blood vessels that assist in patient recovery after cardiac events and reduce the risk of an additional heart attack or death. Many doctors have hoped that there would be similar benefits for patients at risk of stroke.

Research Question: Does the use of stents reduce the risk of stroke?

## Recall data for the 365 day period

```{r}
stent365<-read.csv(file = "stent365.csv")
(table(stent365))

```

- 451 total patients, 224 of them in treatment group
- 73 total patients had stroke event in the one year time period
- 45 patients in treatment group had a stroke event

Suppose that in this group of 451 patients, 73 would have had a stroke event during the year *regardless* of which group they were in.  

**Key Question**: In this case, how likely is it to get 45 (or more) stroke events in the treatment group?

## Create a deck of cards reflecting these results

We can attack the key question via simulation!

First, create a *deck* of 451 cards so that 73 of them have 's' printed on them (for stroke event), the rest have 'n'.

```{r, echo = TRUE}
deck <- rep(c("n","s"),times=c(378,73))
table(deck)
```

## Simulate

We shuffle the deck, randomly deal 224 cards into Treatment group, and see how many 's' cards we get.

```{r, echo=TRUE}
treatment <- sample(deck)[1:224]
table(treatment)
```

## Simulate again

```{r, echo=TRUE}
treatment <- sample(deck)[1:224]
table(treatment)
```

We should expect to get different 's' counts from different samples.  How likely is it to get 45?

How about simulating a bunch of times and see how often that happens?

## Simulate a bunch of times at once

```{r, echo=TRUE}
trials=5000
  L<-c()
  for(x in 1:trials) 
    {L<-c(L,table(sample(deck)[1:224])['s'])}
```
Running this simulation `r trials` times, we found that the treatment group had at least 45 stroke events `r table(L>=45)[2]` times.

In other words, the proportion of times we would randomly deal at least 45 's' cards to the treatment group is about `r prop.table(table(L>=45))[2]`.

## Plotting the distribution for these trials

```{r}
hist(L,
             main=paste0("Simulation Results. ",trials," trials"),
             xlab="# stroke events",
             xlim=c(20,50),
             col="light blue",
             border="brown"
  )
```

## Conclusion


- If we assume the treatments have no effect on the 451 patients in this group, and that 73 of these patients would have had a stroke event in the first year, regardless of treatment, then it is ***very unlikely*** that among 224 randomly chosen patients from the group, 45 or more of them would have a stroke event.

- In fact, our simulation of many trials suggests that such an extreme result happens about `r sprintf("%1.1f%%", 100*prop.table(table(L>=45))[2])` of the time.

- The researchers originally asked whether the use of stents *reduced* the rate of strokes, and the data clearly do not support this claim.  In fact, after running this simulation, I am led to suspect that something about the treatment actually makes a stroke more likely.